var express=require("express");var fs=require("fs");var io=require("socket.io");var crypto=require("crypto");var app=express.createServer();var staticDir=express.static;io=io.listen(app);var opts={port:1948,baseDir:__dirname+"/../../"};io.sockets.on("connection",function(e){e.on("slidechanged",function(r){if(typeof r.secret=="undefined"||r.secret==null||r.secret==="")return;if(createHash(r.secret)===r.socketId){r.secret=null;e.broadcast.emit(r.socketId,r)}})});app.configure(function(){["css","js","plugin","lib"].forEach(function(e){app.use("/"+e,staticDir(opts.baseDir+e))})});app.get("/",function(e,r){fs.createReadStream(opts.baseDir+"/index.html").pipe(r)});app.get("/token",function(e,r){var t=(new Date).getTime();var s=Math.floor(Math.random()*9999999);var o=t.toString()+s.toString();r.send({secret:o,socketId:createHash(o)})});var createHash=function(e){var r=crypto.createCipher("blowfish",e);return r.final("hex")};app.listen(opts.port||null);var brown="[33m",green="[32m",reset="[0m";console.log(brown+"reveal.js:"+reset+" Multiplex running on port "+green+opts.port+reset);